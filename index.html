<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>GeoTab-ClearQuote integration</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  </head>


  <body>
      <iframe class="col-12 vh-100" src="https://cq-uat.web.app/#/pages/home" frameborder="0"></iframe>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

    <!-- Custom script -->
    <script type="text/javaScript">
      console.log("clearquote geotab in JS 1.1");
      geotab.addin.clearquote = function(api, state) {
        return {
          initialize: function(api, state, callback) {
            // Will be called only once per access of CQ add-in (***SSO should be performed here only***)
            console.log("clearquote addin: initialized");

            // [Step 1] Get the Geo tab logged in user's data
            console.log("Result for Geo tab's result data") 
            api.getSession(
              function (result) {
                console.log(result) 
              }
            )

            // [Step 2] Get the server path
            console.log("Server path (window.location.href) -> " + window.location.href)
            console.log("host name (window.location.hostname) -> " + window.location.hostname) // This is need in the api() calls

            // [Step 3] Get device API call
            // Not sure how to check that this call is failed and show a warning error message saying "Incorrect Login Credentials"
            api.call(
              "Get",
              {
                "typeName":"Device",
                "resultsLimit":1,
              },
              function (result) {
                // Log devices
                console.log("Devices")
                console.log(result)

                // If this call is success then do CQ backend validation

                // After backend validation success navigate to the landing page
              },
            );
              
            // Rest
            callback();
          },

          focus: function() {
            // Will be called all the times when user resumes using CQ addin (Can place the CQ add-in landing page's refresh code [***No need to perform SSO again here***])
            console.log("clearquote addin: focused");
          },

          blur: function() {
            // Will be called when, user navigates to other pages (non CQ Add-in pages) of MyGeoTab
            console.log("clearquote addin: blur");
          }
        };
      };
    </script>
  </body>
</html>